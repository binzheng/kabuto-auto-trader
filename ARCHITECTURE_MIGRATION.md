# Kabuto Auto Trader - ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ç§»è¡Œã‚¬ã‚¤ãƒ‰

## æ¦‚è¦

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã¯ã€Kabuto Auto Traderã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å¤‰æ›´ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚

**å¤‰æ›´ã®ç›®çš„**:
- Excel VBAã®æ©Ÿèƒ½ã‚’**æ³¨æ–‡å®Ÿè¡Œã®ã¿**ã«çµã‚‹
- ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’Relay Serverã«é›†ç´„
- ä¿å®ˆæ€§ãƒ»ãƒ†ã‚¹ãƒˆæ€§ãƒ»ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£ã®å‘ä¸Š

---

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¯”è¼ƒ

### æ—§ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ï¼ˆå•é¡Œç‚¹ï¼‰

```
TradingView Webhook
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Excel VBAï¼ˆéå‰°ãªè²¬ä»»ï¼‰         â”‚
â”‚  â”œâ”€ ã‚·ã‚°ãƒŠãƒ«å–å¾—                â”‚
â”‚  â”œâ”€ 5æ®µéšã‚»ãƒ¼ãƒ•ãƒ†ã‚£ãƒã‚§ãƒƒã‚¯    â”‚
â”‚  â”œâ”€ ãƒªã‚¹ã‚¯æ¤œè¨¼                  â”‚
â”‚  â”œâ”€ RSSæ³¨æ–‡å®Ÿè¡Œ                 â”‚
â”‚  â”œâ”€ ãƒã‚¸ã‚·ãƒ§ãƒ³ç®¡ç†              â”‚
â”‚  â”œâ”€ é€šçŸ¥é€ä¿¡ï¼ˆSlack/ãƒ¡ãƒ¼ãƒ«ï¼‰    â”‚
â”‚  â””â”€ ãƒ­ã‚°è¨˜éŒ²                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
MarketSpeed II (RSS)
```

**å•é¡Œç‚¹**:
- âŒ Excel VBAãŒå¤šæ©Ÿèƒ½ã™ãã‚‹ï¼ˆç´„2000è¡Œï¼‰
- âŒ ãƒ†ã‚¹ãƒˆãŒå›°é›£ï¼ˆVBAã®ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã¯é›£ã—ã„ï¼‰
- âŒ ä¿å®ˆãŒå›°é›£ï¼ˆãƒ­ã‚¸ãƒƒã‚¯ãŒVBAã«åŸ‹ã‚è¾¼ã¾ã‚Œã¦ã„ã‚‹ï¼‰
- âŒ ã‚¹ã‚±ãƒ¼ãƒ«ã—ãªã„ï¼ˆ1å°ã®Excelã§ã—ã‹å‹•ä½œã—ãªã„ï¼‰
- âŒ ç›£æŸ»ãƒ­ã‚°ãŒåˆ†æ•£ï¼ˆExcelå†…ã¨ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰

### æ–°ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ï¼ˆè²¬ä»»åˆ†é›¢ï¼‰

```
TradingView Webhook
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Relay Serverï¼ˆãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ä¸­æ¢ï¼‰       â”‚
â”‚  â”œâ”€ TradingViewã‹ã‚‰ã‚·ã‚°ãƒŠãƒ«å—ä¿¡             â”‚
â”‚  â”œâ”€ 5æ®µéšã‚»ãƒ¼ãƒ•ãƒ†ã‚£æ¤œè¨¼                     â”‚
â”‚  â”‚   Level 1: Kill Switch                    â”‚
â”‚  â”‚   Level 2: Market Hours                   â”‚
â”‚  â”‚   Level 3: Parameter Validation           â”‚
â”‚  â”‚   Level 4: Daily Limits                   â”‚
â”‚  â”‚   Level 5: Risk Limits                    â”‚
â”‚  â”œâ”€ ã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³ç®¡ç†ï¼ˆRedisï¼‰               â”‚
â”‚  â”œâ”€ ãƒ–ãƒ©ãƒƒã‚¯ãƒªã‚¹ãƒˆç®¡ç†                      â”‚
â”‚  â”œâ”€ DBä¿å­˜ï¼ˆSignal/Position/ExecutionLogï¼‰  â”‚
â”‚  â”œâ”€ é€šçŸ¥é€ä¿¡ï¼ˆSlack/ãƒ¡ãƒ¼ãƒ«ï¼‰                â”‚
â”‚  â””â”€ æ¤œè¨¼æ¸ˆã¿ã‚·ã‚°ãƒŠãƒ«é…ä¿¡                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“ API (æ¤œè¨¼æ¸ˆã¿ã‚·ã‚°ãƒŠãƒ«ã®ã¿)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Excel VBAï¼ˆæ³¨æ–‡å®Ÿè¡Œã®ã¿ï¼‰       â”‚
â”‚  â”œâ”€ GET /api/signals/pending    â”‚
â”‚  â”œâ”€ RSSæ³¨æ–‡å®Ÿè¡Œ                 â”‚
â”‚  â””â”€ POST /api/signals/executed  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
MarketSpeed II (RSS)
```

**ãƒ¡ãƒªãƒƒãƒˆ**:
- âœ… è²¬ä»»ãŒæ˜ç¢ºï¼ˆExcel = æ³¨æ–‡å®Ÿè¡Œã€Server = å…¨ãƒ­ã‚¸ãƒƒã‚¯ï¼‰
- âœ… VBAã‚³ãƒ¼ãƒ‰ãŒç´„1/5ã«å‰Šæ¸›ï¼ˆ2000è¡Œ â†’ 400è¡Œï¼‰
- âœ… ãƒ†ã‚¹ãƒˆå¯èƒ½ï¼ˆRelay Serverå´ã§ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆï¼‰
- âœ… ä¿å®ˆå®¹æ˜“ï¼ˆPythonã§è¨˜è¿°ã€ãƒ­ã‚¸ãƒƒã‚¯å¤‰æ›´ãŒå®¹æ˜“ï¼‰
- âœ… ã‚¹ã‚±ãƒ¼ãƒ«å¯èƒ½ï¼ˆè¤‡æ•°Excelã‹ã‚‰åŒã˜Serverã«æ¥ç¶šå¯èƒ½ï¼‰
- âœ… ç›£æŸ»ãƒ­ã‚°çµ±åˆï¼ˆå…¨ã¦DB + Slacké€šçŸ¥ï¼‰

---

## æ©Ÿèƒ½ãƒãƒƒãƒ”ãƒ³ã‚°

### Relay Serverã«ç§»è¡Œã—ãŸæ©Ÿèƒ½

| æ—§ï¼ˆExcel VBAï¼‰ | æ–°ï¼ˆRelay Serverï¼‰ | ç†ç”± |
|----------------|-------------------|------|
| Module_Main.basï¼ˆãƒãƒ¼ãƒªãƒ³ã‚°ï¼‰ | main.pyï¼ˆã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³èµ·å‹•ï¼‰ | ã‚µãƒ¼ãƒãƒ¼å´ã§ã‚·ã‚°ãƒŠãƒ«ç®¡ç† |
| Module_SignalProcessor.bas | webhook.py, signals.py | ã‚·ã‚°ãƒŠãƒ«å‡¦ç†ã®é›†ä¸­ç®¡ç† |
| Module_RSS.basï¼ˆ5æ®µéšã‚»ãƒ¼ãƒ•ãƒ†ã‚£ï¼‰ | pre_order_validation.py | æ¤œè¨¼ãƒ­ã‚¸ãƒƒã‚¯ã®çµ±ä¸€ |
| Module_Notification.bas | notification.py | é€šçŸ¥ã®é›†ä¸­ç®¡ç† |
| Module_Config.basï¼ˆå¤§éƒ¨åˆ†ï¼‰ | config.py, config.yaml | è¨­å®šã®å¤–éƒ¨åŒ– |
| Module_Logger.basï¼ˆå¤§éƒ¨åˆ†ï¼‰ | logging.py, csv_logger.py | ãƒ­ã‚°ã®çµ±åˆ |

### Excel VBAå´ã«æ®‹ã£ãŸæ©Ÿèƒ½

| ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« | æ©Ÿèƒ½ | è¡Œæ•° |
|-----------|------|------|
| Module_Main_Simple.bas | ãƒãƒ¼ãƒªãƒ³ã‚°ãƒ«ãƒ¼ãƒ—ã€æ³¨æ–‡å®Ÿè¡Œ | ~200è¡Œ |
| Module_API_Simple.bas | APIé€šä¿¡ï¼ˆ4ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼‰ | ~150è¡Œ |
| Module_Config_Simple.bas | è¨­å®šèª­ã¿è¾¼ã¿ | ~50è¡Œ |

**åˆè¨ˆ: ç´„400è¡Œ**ï¼ˆæ—§: ç´„2000è¡Œï¼‰

---

## ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼è©³ç´°

### 1. ã‚·ã‚°ãƒŠãƒ«å—ä¿¡ãƒ•ãƒ­ãƒ¼

```
TradingView Alert
    â†“
POST /webhook
{
  "passphrase": "secret",
  "action": "buy",
  "ticker": "7203",
  "quantity": 100,
  "price": 1850.0,
  "entry_price": 1850.0,
  "stop_loss": 1800.0,
  "take_profit": 1950.0,
  "timestamp": "2026-01-10T09:35:00"
}
    â†“
[Relay Server: webhook.py]
    â”œâ”€ ãƒ‘ã‚¹ãƒ•ãƒ¬ãƒ¼ã‚ºæ¤œè¨¼
    â”œâ”€ é‡è¤‡æ’é™¤ãƒã‚§ãƒƒã‚¯ï¼ˆRedisï¼‰
    â”œâ”€ å¸‚å ´æ™‚é–“ãƒã‚§ãƒƒã‚¯
    â”œâ”€ ã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³ãƒã‚§ãƒƒã‚¯ï¼ˆRedisï¼‰
    â”œâ”€ ãƒã‚¸ã‚·ãƒ§ãƒ³ç¢ºèªï¼ˆå£²ã‚Šã®å ´åˆï¼‰
    â””â”€ DBä¿å­˜ï¼ˆstate = PENDINGï¼‰
         signal_id: sig_20260110_093500_7203_buy
```

### 2. æ¤œè¨¼ãƒ•ãƒ­ãƒ¼ï¼ˆ5æ®µéšã‚»ãƒ¼ãƒ•ãƒ†ã‚£ï¼‰

```
Excel VBA Polling
    â†“
GET /api/signals/pending
Authorization: Bearer <api_key>
    â†“
[Relay Server: signals.py]
    â”œâ”€ DB query (state = PENDING, not expired)
    â””â”€ For each signal:
         â†“
    [PreOrderValidationService]
         â”œâ”€ Level 1: Kill Switch âœ“
         â”œâ”€ Level 2: Market Hours âœ“
         â”œâ”€ Level 3: Parameter Validation âœ“
         â”œâ”€ Level 4: Daily Limits âœ“
         â””â”€ Level 5: Risk Limits âœ“
              â†“
         PASS: Return signal to Excel
         FAIL: Mark as REJECTED, log violation
    â†“
Response: 200 OK
{
  "status": "success",
  "count": 1,
  "signals": [
    {
      "signal_id": "sig_20260110_093500_7203_buy",
      "action": "buy",
      "ticker": "7203",
      "quantity": 100,
      "checksum": "a1b2c3d4e5f6g7h8"
    }
  ]
}
```

### 3. æ³¨æ–‡å®Ÿè¡Œãƒ•ãƒ­ãƒ¼

```
[Excel VBA]
    â†“
POST /api/signals/{signal_id}/ack
{
  "client_id": "excel_vba_01",
  "checksum": "a1b2c3d4e5f6g7h8"
}
    â†“
[Relay Server]
    â””â”€ Signal state: PENDING â†’ FETCHED
    â†“
[Excel VBA: ExecuteRSSOrder()]
    â†“
RssStockOrder_v(
  order_id="ORD_20260110093510_007203",
  ticker="7203",
  side=3,  # ç¾ç‰©è²·
  quantity=100,
  price_type=0,  # æˆè¡Œ
  ...
)
    â†“
[MarketSpeed II]
    â””â”€ æ³¨æ–‡åŸ·è¡Œ
         â†“
    SUCCESS: order_id="ORD_20260110093510_007203"
    â†“
[Excel VBA]
    â†“
POST /api/signals/{signal_id}/executed
{
  "order_id": "ORD_20260110093510_007203",
  "execution_price": 1850.0,
  "execution_quantity": 100,
  "executed_at": "2026-01-10T09:35:15"
}
    â†“
[Relay Server: signals.py]
    â”œâ”€ Signal state: FETCHED â†’ EXECUTED
    â”œâ”€ ExecutionLogè¨˜éŒ²
    â”œâ”€ Positionæ›´æ–°
    â”œâ”€ DailyStatsæ›´æ–°
    â””â”€ é€šçŸ¥é€ä¿¡ï¼ˆSlackï¼‰
```

### 4. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ•ãƒ­ãƒ¼

```
[Excel VBA: ExecuteRSSOrder()]
    â†“
RssStockOrder_v() â†’ Error
    â†“
[Excel VBA]
    â†“
POST /api/signals/{signal_id}/failed
{
  "error": "RSS connection timeout"
}
    â†“
[Relay Server: signals.py]
    â”œâ”€ Signal state: FETCHED â†’ FAILED
    â”œâ”€ error_messageè¨˜éŒ²
    â”œâ”€ DailyStatsæ›´æ–°ï¼ˆconsecutive_losses++ï¼‰
    â””â”€ é€šçŸ¥é€ä¿¡ï¼ˆSlack/ãƒ¡ãƒ¼ãƒ«ï¼‰
         â†“
    [RiskControlService]
         â””â”€ é€£ç¶šå¤±æ•— >= 5å›?
              YES â†’ Kill Switchè‡ªå‹•ç™ºå‹•
                   â””â”€ CRITICALé€šçŸ¥ï¼ˆ@channelï¼‰
```

---

## 5æ®µéšã‚»ãƒ¼ãƒ•ãƒ†ã‚£ã‚·ã‚¹ãƒ†ãƒ 

### Level 1: Kill Switch

**å ´æ‰€**: `relay_server/app/services/kill_switch.py`

**ãƒã‚§ãƒƒã‚¯å†…å®¹**:
- ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã®åœæ­¢ã‚¹ã‚¤ãƒƒãƒãŒæœ‰åŠ¹ã‹ç¢ºèª
- DB (`SystemConfig` ãƒ†ãƒ¼ãƒ–ãƒ«) ã§ç®¡ç†

**è‡ªå‹•ç™ºå‹•æ¡ä»¶**:
- é€£ç¶šå¤±æ•—ãŒ5å›ä»¥ä¸Š
- æ—¥æ¬¡æå¤±ãŒ-5ä¸‡å††ä»¥ä¸Š
- æ™‚é–“å½“ãŸã‚Šå–å¼•ãŒ10å›ä»¥ä¸Š

**æ‰‹å‹•åˆ¶å¾¡**:
```bash
# ç™ºå‹•
curl -X POST http://localhost:5000/api/admin/kill-switch/activate \
  -H "Content-Type: application/json" \
  -d '{"reason": "Manual stop"}'

# è§£é™¤
curl -X POST http://localhost:5000/api/admin/kill-switch/deactivate
```

### Level 2: Market Hours

**å ´æ‰€**: `relay_server/app/services/market_hours.py`

**ãƒã‚§ãƒƒã‚¯å†…å®¹**:
- ç¾åœ¨æ™‚åˆ»ãŒå®‰å…¨ãªå–å¼•æ™‚é–“å¸¯ã‹ç¢ºèª
- ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³: Asia/Tokyo

**å®‰å…¨ãªå–å¼•æ™‚é–“å¸¯**:
- åˆå‰: 9:30-11:20
- åˆå¾Œ: 13:00-14:30

**ç†ç”±**:
- å¯„ã‚Šä»˜ããƒ»å¼•ã‘ã®æ€¥æ¿€ãªå€¤å‹•ãã‚’é¿ã‘ã‚‹
- æ˜¼ä¼‘ã¿ã®æµå‹•æ€§ä¸è¶³ã‚’é¿ã‘ã‚‹

### Level 3: Parameter Validation

**å ´æ‰€**: `relay_server/app/services/pre_order_validation.py`

**ãƒã‚§ãƒƒã‚¯å†…å®¹**:

1. **ãƒ†ã‚£ãƒƒã‚«ãƒ¼ã‚³ãƒ¼ãƒ‰**:
   - 4æ¡ã®æ•°å­—ã‹ï¼ˆä¾‹: 7203ï¼‰
   - ãƒ–ãƒ©ãƒƒã‚¯ãƒªã‚¹ãƒˆã«å«ã¾ã‚Œã¦ã„ãªã„ã‹

2. **å£²è²·åŒºåˆ†**:
   - "buy" ã¾ãŸã¯ "sell" ã®ã¿
   - å£²ã‚Šæ³¨æ–‡ã®å ´åˆã€ãƒã‚¸ã‚·ãƒ§ãƒ³ãŒå­˜åœ¨ã™ã‚‹ã‹

3. **æ•°é‡**:
   - 100æ ªå˜ä½ã‹
   - 100æ ªä»¥ä¸Šã€10,000æ ªä»¥ä¸‹
   - å£²ã‚Šæ³¨æ–‡ã®å ´åˆã€ä¿æœ‰æ ªæ•°ä»¥ä¸‹ã‹

4. **ä¾¡æ ¼ã‚¿ã‚¤ãƒ—**:
   - "market"ï¼ˆæˆè¡Œï¼‰ã®ã¿è¨±å¯
   - æŒ‡å€¤ã¯å®‰å…¨æ€§ã®ãŸã‚ç¦æ­¢

### Level 4: Daily Limits

**å ´æ‰€**: `relay_server/app/services/pre_order_validation.py`

**ãƒã‚§ãƒƒã‚¯å†…å®¹**:
- æ—¥æ¬¡ã‚¨ãƒ³ãƒˆãƒªãƒ¼æ•°ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 5å›ï¼‰
- æ—¥æ¬¡å–å¼•æ•°ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 15å›ï¼‰
- æ™‚é–“å½“ãŸã‚Šå–å¼•æ•°ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 5å›ï¼‰

**ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹**: `DailyStats` ãƒ†ãƒ¼ãƒ–ãƒ«

### Level 5: Risk Limits

**å ´æ‰€**: `relay_server/app/services/pre_order_validation.py`

**ãƒã‚§ãƒƒã‚¯å†…å®¹**:

1. **æœ€å¤§ã‚¨ã‚¯ã‚¹ãƒãƒ¼ã‚¸ãƒ£ãƒ¼**:
   - å…¨ãƒã‚¸ã‚·ãƒ§ãƒ³ã®åˆè¨ˆé‡‘é¡
   - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 100ä¸‡å††

2. **ãƒ†ã‚£ãƒƒã‚«ãƒ¼å½“ãŸã‚Šæœ€å¤§ãƒã‚¸ã‚·ãƒ§ãƒ³**:
   - å˜ä¸€éŠ˜æŸ„ã®æœ€å¤§é‡‘é¡
   - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 20ä¸‡å††

3. **æœ€å¤§ã‚ªãƒ¼ãƒ—ãƒ³ãƒã‚¸ã‚·ãƒ§ãƒ³æ•°**:
   - åŒæ™‚ä¿æœ‰å¯èƒ½ãªéŠ˜æŸ„æ•°
   - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 5éŠ˜æŸ„

4. **æ—¥æ¬¡æœ€å¤§æå¤±**:
   - æœ¬æ—¥ã®ç´¯ç©æå¤±
   - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: -5ä¸‡å††

**ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹**: `Position` ãƒ†ãƒ¼ãƒ–ãƒ«ã€`DailyStats` ãƒ†ãƒ¼ãƒ–ãƒ«

---

## é€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ 

### Slacké€šçŸ¥

**å®Ÿè£…**: `relay_server/app/core/notification.py`

**ãƒ¬ãƒ™ãƒ«åˆ¥Webhook URL**:
```yaml
alerts:
  slack_webhook_urls:
    INFO: "https://hooks.slack.com/services/.../INFO"
    WARNING: "https://hooks.slack.com/services/.../WARNING"
    ERROR: "https://hooks.slack.com/services/.../ERROR"
    CRITICAL: "https://hooks.slack.com/services/.../CRITICAL"
```

**é€šçŸ¥å†…å®¹**:

| ãƒ¬ãƒ™ãƒ« | è‰² | å†…å®¹ | ä¾‹ |
|--------|---|------|---|
| INFO | ç·‘ | ã‚·ã‚¹ãƒ†ãƒ èµ·å‹• | "ã‚·ã‚¹ãƒ†ãƒ èµ·å‹•" |
| WARNING | é»„ | ç™ºæ³¨å¤±æ•—ï¼ˆ1å›ï¼‰ | "ç™ºæ³¨å¤±æ•—: 7203 ã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³ä¸­" |
| ERROR | èµ¤ | é€£ç¶šç™ºæ³¨å¤±æ•—ï¼ˆ3å›ä»¥ä¸Šï¼‰ | "é€£ç¶šç™ºæ³¨å¤±æ•—ï¼ˆ5å›ï¼‰" |
| CRITICAL | èµ¤+@channel | Kill Switchç™ºå‹• | "ğŸš¨ğŸš¨ğŸš¨ KILL SWITCH ç™ºå‹•" |

### ãƒ¡ãƒ¼ãƒ«é€šçŸ¥

**å®Ÿè£…**: `relay_server/app/core/notification.py`

**é€ä¿¡æ¡ä»¶**: ERRORä»¥ä¸Š

**ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ**: HTML

**å†…å®¹**:
- ã‚¨ãƒ©ãƒ¼ç¨®åˆ¥
- ç™ºç”Ÿæ™‚åˆ»
- æ¨å¥¨å¯¾å¿œ
- ã‚·ã‚¹ãƒ†ãƒ ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹

### é€šçŸ¥é »åº¦åˆ¶é™

**å®Ÿè£…**: Redisã§ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ç®¡ç†

**åˆ¶é™**:
- INFO: 60åˆ†ã«1å›
- WARNING: 30åˆ†ã«1å›
- ERROR: 15åˆ†ã«1å›
- CRITICAL: åˆ¶é™ãªã—ï¼ˆå¸¸ã«é€ä¿¡ï¼‰

**ã‚­ãƒ¼**: `notification:last:{level}:{title}`

---

## ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒ

### Signal ãƒ†ãƒ¼ãƒ–ãƒ«

```python
signal_id: str          # sig_20260110_093500_7203_buy
action: str             # "buy" or "sell"
ticker: str             # "7203"
quantity: int           # 100
price: float            # 1850.0
entry_price: float      # 1850.0
stop_loss: float        # 1800.0
take_profit: float      # 1950.0
state: SignalState      # PENDING/FETCHED/EXECUTED/FAILED/REJECTED
checksum: str           # "a1b2c3d4e5f6g7h8"
created_at: datetime
expires_at: datetime
fetched_by: str         # "excel_vba_01"
fetched_at: datetime
executed_at: datetime
execution_price: float
order_id: str           # "ORD_20260110093510_007203"
error_message: str
```

### ExecutionLog ãƒ†ãƒ¼ãƒ–ãƒ«

```python
execution_id: str       # EXE_20260110_093515_7203
signal_id: str          # sig_20260110_093500_7203_buy
order_id: str           # ORD_20260110093510_007203
action: str             # "buy"
ticker: str             # "7203"
quantity: int           # 100
price: float            # 1850.0
commission: float       # 0
total_amount: float     # 185000.0
position_effect: str    # "open" or "close"
executed_at: datetime
```

### Position ãƒ†ãƒ¼ãƒ–ãƒ«

```python
ticker: str             # "7203"
ticker_name: str        # "ãƒˆãƒ¨ã‚¿è‡ªå‹•è»Š"
quantity: int           # 100
avg_cost: float         # 1850.0
sector: str             # "è‡ªå‹•è»Š"
entry_signal_id: str    # sig_20260110_093500_7203_buy
created_at: datetime
updated_at: datetime
```

### DailyStats ãƒ†ãƒ¼ãƒ–ãƒ«

```python
date: date              # 2026-01-10
entry_count: int        # 3
exit_count: int         # 2
total_trades: int       # 5
total_pnl: float        # 15000.0
consecutive_losses: int # 0
error_count: int        # 0
created_at: datetime
updated_at: datetime
```

---

## ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †

### 1. ç’°å¢ƒæº–å‚™

```bash
# Python 3.9+
python --version

# Redis
redis-server --version

# PostgreSQL (æœ¬ç•ªç’°å¢ƒæ¨å¥¨)
psql --version
```

### 2. Relay Serverã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

```bash
cd relay_server

# ä»®æƒ³ç’°å¢ƒä½œæˆ
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate

# ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
pip install -r requirements.txt

# è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚³ãƒ”ãƒ¼
cp config.yaml.example config.yaml

# config.yamlã‚’ç·¨é›†
vim config.yaml
```

### 3. Redisèµ·å‹•

```bash
# macOS/Linux
redis-server

# Docker
docker run -d -p 6379:6379 redis:latest
```

### 4. Relay Serverèµ·å‹•

```bash
cd relay_server
python app/main.py
```

**ãƒ­ã‚°ç¢ºèª**:
```
=============================================================
Kabuto Relay Server Starting...
=============================================================
Logging initialized
Configuration loaded from config.yaml
Database initialized
Redis initialized: localhost:6379
Notification manager initialized
Server: 0.0.0.0:5000
Database: sqlite:///./data/kabuto.db
Redis: localhost:6379
=============================================================
Kabuto Relay Server Started Successfully
=============================================================
```

### 5. Excel VBAã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

1. `excel_vba_simplified/README.md` ã‚’å‚ç…§
2. 3ã¤ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
3. Configã‚·ãƒ¼ãƒˆã‚’ä½œæˆãƒ»è¨­å®š
4. OrderLogã‚·ãƒ¼ãƒˆã‚’ä½œæˆ

### 6. å‹•ä½œç¢ºèª

```bash
# APIæ¥ç¶šãƒ†ã‚¹ãƒˆ
curl http://localhost:5000/ping

# ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç¢ºèª
curl http://localhost:5000/status

# Healthãƒã‚§ãƒƒã‚¯
curl http://localhost:5000/health
```

---

## ç§»è¡Œãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### Relay Serverå´

- [ ] config.yamlã‚’ä½œæˆãƒ»è¨­å®š
- [ ] Redisã‚’èµ·å‹•
- [ ] Relay Serverã‚’èµ·å‹•
- [ ] `/health` ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãŒ200 OKã‚’è¿”ã™ã‹ç¢ºèª
- [ ] Slacké€šçŸ¥ã®ãƒ†ã‚¹ãƒˆ
- [ ] ãƒ¡ãƒ¼ãƒ«é€šçŸ¥ã®ãƒ†ã‚¹ãƒˆ

### Excel VBAå´

- [ ] ç°¡ç•¥ç‰ˆãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆ3å€‹ï¼‰ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
- [ ] Configã‚·ãƒ¼ãƒˆã‚’ä½œæˆ
- [ ] OrderLogã‚·ãƒ¼ãƒˆã‚’ä½œæˆ
- [ ] API_TestConnection()ãŒæˆåŠŸã™ã‚‹ã‹ç¢ºèª
- [ ] ãƒãƒ¼ãƒªãƒ³ã‚°é–‹å§‹ï¼ˆStartPollingï¼‰

### TradingViewå´

- [ ] Webhook URLã‚’æ›´æ–°ï¼ˆRelay Serverã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼‰
- [ ] Passphraseã‚’è¨­å®šï¼ˆconfig.yamlã®webhook_secretã¨ä¸€è‡´ï¼‰
- [ ] ãƒ†ã‚¹ãƒˆã‚¢ãƒ©ãƒ¼ãƒˆã‚’é€ä¿¡

---

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### Relay ServerãŒèµ·å‹•ã—ãªã„

**åŸå› **: Redisã«æ¥ç¶šã§ããªã„

**è§£æ±º**:
```bash
# Redisèµ·å‹•ç¢ºèª
redis-cli ping
# â†’ PONG ãŒè¿”ã‚Œã°OK

# Redisèµ·å‹•
redis-server
```

### Excel VBAãŒã‚·ã‚°ãƒŠãƒ«ã‚’å–å¾—ã§ããªã„

**åŸå› 1**: Relay ServerãŒèµ·å‹•ã—ã¦ã„ãªã„

**è§£æ±º**:
```bash
curl http://localhost:5000/ping
```

**åŸå› 2**: API keyãŒé–“é•ã£ã¦ã„ã‚‹

**è§£æ±º**:
- Configã‚·ãƒ¼ãƒˆã®API_KEYã¨config.yamlã®api_keyãŒä¸€è‡´ã™ã‚‹ã‹ç¢ºèª

**åŸå› 3**: ã‚·ã‚°ãƒŠãƒ«ãŒ5æ®µéšã‚»ãƒ¼ãƒ•ãƒ†ã‚£ã§æ‹’å¦ã•ã‚Œã¦ã„ã‚‹

**è§£æ±º**:
```bash
# Relay Serverã®ãƒ­ã‚°ç¢ºèª
tail -f relay_server/data/logs/kabuto_*.log | grep "failed validation"
```

### æ³¨æ–‡ãŒå®Ÿè¡Œã•ã‚Œãªã„

**åŸå› **: MarketSpeed IIã®RSSæ©Ÿèƒ½ãŒç„¡åŠ¹

**è§£æ±º**:
- MarketSpeed IIãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‹ç¢ºèª
- RSSæ©Ÿèƒ½ãŒæœ‰åŠ¹ã‹ç¢ºèª
- ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã‚’ç¢ºèª

---

## ã¾ã¨ã‚

### å¤‰æ›´ã®ãƒ¡ãƒªãƒƒãƒˆ

| é …ç›® | æ—§ | æ–° | æ”¹å–„ |
|-----|---|---|------|
| VBAè¡Œæ•° | 2000è¡Œ | 400è¡Œ | 80%å‰Šæ¸› |
| ä¿å®ˆæ€§ | ä½ï¼ˆVBAï¼‰ | é«˜ï¼ˆPythonï¼‰ | âœ… |
| ãƒ†ã‚¹ãƒˆæ€§ | å›°é›£ | å®¹æ˜“ï¼ˆãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆï¼‰ | âœ… |
| ã‚¹ã‚±ãƒ¼ãƒ«æ€§ | 1å°ã®ã¿ | è¤‡æ•°Excelå¯èƒ½ | âœ… |
| ç›£æŸ»ãƒ­ã‚° | åˆ†æ•£ | çµ±åˆï¼ˆDBï¼‰ | âœ… |
| é€šçŸ¥ | Excelå†…ã®ã¿ | Slack/ãƒ¡ãƒ¼ãƒ« | âœ… |

### æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

1. **æœ¬ç•ªç’°å¢ƒæº–å‚™**:
   - PostgreSQLãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
   - Dockerã‚³ãƒ³ãƒ†ãƒŠåŒ–
   - systemdã§Relay Serverè‡ªå‹•èµ·å‹•

2. **ç›£è¦–å¼·åŒ–**:
   - Prometheus + Grafanaã§ãƒ¡ãƒˆãƒªã‚¯ã‚¹ç›£è¦–
   - ãƒ­ã‚°åˆ†æï¼ˆELK Stackï¼‰

3. **æ©Ÿèƒ½è¿½åŠ **:
   - Webãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ï¼ˆVue.js + FastAPIï¼‰
   - ãƒãƒƒã‚¯ãƒ†ã‚¹ãƒˆæ©Ÿèƒ½
   - ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªæœ€é©åŒ–

---

**ä½œæˆæ—¥**: 2026-01-10
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0.0
